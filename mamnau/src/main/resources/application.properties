#############################################
# ?NG D?NG SPRING BOOT ? M?M NÂU / M?M XANH
#############################################

spring.application.name=mamnau

# PORT
# ? Local: ch?y 8081 (tránh trùng 8080)
# ? Azure: s? t? l?y WEBSITES_PORT do App Service truy?n vào
server.port=${WEBSITES_PORT:8081}
server.address=0.0.0.0

#############################################
# 1. K?T N?I C? S? D? LI?U POSTGRESQL
#############################################
# M?c ??nh LOCAL: PostgreSQL trên máy b?n
# Khi deploy Azure ? truy?n JDBC_URL, DB_USER, DB_PASSWORD qua Environment Variables
spring.datasource.url=${SPRING_DATASOURCE_URL:${JDBC_URL:jdbc:postgresql://localhost:5432/mamnau}}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:${DB_USER:postgres}}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:${DB_PASSWORD:123456}}
spring.datasource.driver-class-name=org.postgresql.Driver

# Hikari Connection Pool (g?n nh?)
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.idle-timeout=30000
spring.datasource.hikari.connection-timeout=15000
spring.datasource.hikari.validation-timeout=5000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.keepalive-time=300000

#############################################
# 2. THYMELEAF
#############################################
spring.thymeleaf.prefix=classpath:/templates/
spring.thymeleaf.suffix=.html
spring.thymeleaf.cache=false

#############################################
# 3. JPA / HIBERNATE
#############################################
spring.jpa.hibernate.ddl-auto=update
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.show-sql=true

# T?i ?u batch
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.generate_statistics=false

#############################################
# 4. EMAIL (SMTP GMAIL)
#############################################
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=${MAIL_USER:}
spring.mail.password=${MAIL_PASS:}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.starttls.required=true
spring.mail.properties.mail.smtp.ssl.trust=smtp.gmail.com

# Email nh?n t? form liên h?
app.contact.to=${CONTACT_TO:mamxanhh.ct@gmail.com}

#############################################
# 5. ACTUATOR (tu? ch?n ki?m tra health)
#############################################
management.endpoints.web.exposure.include=health,info
management.endpoint.health.probes.enabled=true
management.health.livenessstate.enabled=true
management.health.readinessstate.enabled=true

#############################################
# 6. GRACEFUL SHUTDOWN (t?t êm)
#############################################
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=30s

#############################################
# 7. LOGGING (tu? ch?n)
# logging.pattern.console=%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg [%F:%L]%n
# logging.level.org.hibernate.SQL=DEBUG
# logging.level.org.hibernate.loader.Loader=TRACE
#############################################
